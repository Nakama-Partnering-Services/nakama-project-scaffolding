image: salesforce/salesforcedx:latest-full

definitions:
    caches:
        custom-npm-cache: node_modules

pipelines:
    pull-requests:
        main:
            - parallel:
                  - step:
                        script:
                            - echo "Verify formatting"
                  - step:
                        script:
                            - echo "Verify ESLINT"
                  - step:
                        script:
                            - echo "Verify PMD"
            - parallel:
                  - step:
                        script:
                            - echo "Generate deltas"
                        artifacts:
                            - deltas/**
                  - step:
                        deployment: DEVINT
                        script:
                            - echo "Deployment to DEVINT"
        rc/*:
            - step:
                  script:
                      - echo "Generate deltas"
                  artifacts:
                      - deltas/**
            - step:
                  deployment: STAGING
                  script:
                      - echo "Deployment to STAGING"
        patch/*:
            - step:
                  script:
                      - echo "Generate deltas"
                  artifacts:
                      - deltas/**
            - step:
                  deployment: PRODUCTION
                  script:
                      - echo "Deployment to PRODUCTION"
    branches:
        main:
            - step:
                  script:
                      - echo "Generate deltas"
                  artifacts:
                      - deltas/**
            - step:
                  deployment: DEVINT
                  script:
                      - echo "Deployment to DEVINT"
        rc/*:
            - step:
                  script:
                      - echo "Generate deltas"
                  artifacts:
                      - deltas/**
            - step:
                  deployment: STAGING
                  script:
                      - echo "Deployment to STAGING"
    custom:
        schedules-validation-deployment:
            - variables:
                  - name: DESTINATION_ENVIRONMENT
            - step:
                  script:
                      - echo "Manual triggers for Sonar are awesome!"
        deploy-to-production:
            - variables:
                  - name: destination
                    allowed-values:
                        - 'DEVINT'
                        - 'TESTING'
                        - 'STAGING'
                        - 'PRODUCTION'
                  - name: checkonly
                    default: 'true'
                  - name: testlevel
                    default: 'RunLocalTests'
                  - name: runtests
            - step:
                  trigger: manual
                  script:
                      - echo "Manual triggers for deployments are awesome!"
